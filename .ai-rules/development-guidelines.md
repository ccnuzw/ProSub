---
title: Development Guidelines
description: "Defines coding standards, development practices, and contribution guidelines."
inclusion: always
---

# ProSub 开发规范

## 编码标准

### TypeScript 规范
1. **类型安全**：
   - 所有函数参数和返回值必须明确声明类型
   - 避免使用 any 类型，除非在极少数情况下并添加注释说明
   - 合理使用接口和类型别名定义复杂数据结构

2. **命名规范**：
   - 接口名使用 PascalCase，通常不加 I 前缀
   - 泛型参数使用单个大写字母（T, K, V, E 等）
   - 常量使用 UPPER_SNAKE_CASE
   - 变量和函数使用 camelCase

3. **函数设计**：
   - 函数应尽量保持简短和单一职责
   - 纯函数优先，减少副作用
   - 合理使用可选参数和默认参数

### Vue 3 Composition API 规范
1. **组件结构**：
   - 使用 `<script setup lang="ts">` 语法糖
   - 按照 `imports` → `props` → `data` → `computed` → `methods` → `lifecycle` 的顺序组织代码
   - 保持模板简洁，复杂逻辑应抽取到组合式函数中

2. **响应式数据**：
   - 优先使用 `ref` 和 `reactive` 管理状态
   - 合理使用 `computed` 和 `watch` 处理派生数据和副作用

3. **组件通信**：
   - 父子组件通信使用 props 和 emits
   - 跨层级组件通信使用 provide/inject
   - 全局状态管理使用 Pinia

### 样式规范
1. **CSS 类名**：
   - 使用 BEM 命名规范
   - 组件根元素使用与组件名一致的类名（kebab-case）

2. **样式隔离**：
   - 使用 scoped CSS 避免样式污染
   - 必要时使用 CSS Modules

3. **响应式设计**：
   - 使用 CSS Grid 和 Flexbox 实现布局
   - 媒体查询断点保持一致性

## 代码质量保证

### 代码审查
1. **审查清单**：
   - 代码是否符合编码规范
   - 是否有适当的错误处理
   - 是否有必要的注释和文档
   - 是否进行了充分的测试

2. **审查流程**：
   - 所有 Pull Request 需至少一名其他开发者审查
   - 审查者应实际运行代码并验证功能
   - 重大变更需要架构师或项目负责人批准

### 测试策略
1. **单元测试**：
   - 业务逻辑函数必须有单元测试覆盖
   - 组件测试应覆盖主要功能和边界情况
   - 测试覆盖率目标为 80% 以上

2. **集成测试**：
   - API 接口需要有集成测试验证
   - 数据库操作需要测试事务和边界情况

3. **端到端测试**：
   - 关键用户流程必须有端到端测试
   - 测试应覆盖主要功能路径

### 静态分析
1. **ESLint**：
   - 所有代码必须通过 ESLint 检查
   - 不允许有任何 error 级别的警告

2. **Prettier**：
   - 所有代码必须通过 Prettier 格式化
   - 提交前应自动格式化代码

## Git 工作流程

### 分支策略
1. **主分支**：
   - `main`：生产环境代码
   - 仅允许通过 Pull Request 合并

2. **开发分支**：
   - 功能开发应在特性分支进行
   - 分支命名：`feature/功能描述`、`bugfix/问题描述`

### 提交规范
1. **提交信息**：
   - 使用 conventional commits 规范
   - 格式：`<type>(<scope>): <subject>`
   - 常用类型：feat, fix, chore, docs, style, refactor, perf, test

2. **提交频率**：
   - 小步提交，保持提交历史清晰
   - 每次提交应能通过所有测试

### 合并流程
1. **Pull Request**：
   - PR 描述应包含变更内容和测试情况
   - 关联相关 issue 或任务
   - 通过所有自动化检查后方可合并

## API 设计规范

### RESTful API 原则
1. **资源命名**：
   - 使用复数名词表示资源集合
   - 使用 kebab-case 命名路径

2. **HTTP 方法**：
   - GET：获取资源
   - POST：创建资源
   - PUT：更新资源
   - DELETE：删除资源

3. **状态码**：
   - 200：成功
   - 201：创建成功
   - 400：客户端错误
   - 401：未认证
   - 403：无权限
   - 404：资源不存在
   - 500：服务器错误

### 数据格式
1. **请求/响应**：
   - 使用 JSON 格式传输数据
   - 日期时间使用 ISO 8601 格式

2. **错误响应**：
   - 统一错误响应格式
   - 包含错误码和可读的错误信息

## 数据库设计规范

### 表结构设计
1. **命名规范**：
   - 表名使用复数名词
   - 字段名使用 snake_case
   - 主键统一命名为 id

2. **字段类型**：
   - 合理选择数据类型，避免浪费存储空间
   - 使用适当的约束（NOT NULL, UNIQUE等）

3. **索引设计**：
   - 为常用查询字段创建索引
   - 避免过多索引影响写入性能

### 查询规范
1. **SQL 编写**：
   - 避免 SELECT *，明确指定需要的字段
   - 使用参数化查询防止 SQL 注入

2. **性能优化**：
   - 复杂查询应进行性能分析
   - 合理使用分页避免大量数据传输

## 安全规范

### 认证授权
1. **用户认证**：
   - 使用安全的密码存储机制
   - 实现会话管理和超时机制

2. **权限控制**：
   - 实现基于角色的访问控制（RBAC）
   - 敏感操作需要二次验证

### 数据安全
1. **敏感信息**：
   - 不在日志中记录敏感信息
   - 使用环境变量管理密钥

2. **输入验证**：
   - 所有用户输入必须验证和清理
   - 防止 XSS 和 CSRF 攻击

## 性能优化

### 前端优化
1. **打包优化**：
   - 合理拆分代码包
   - 使用 Tree Shaking 移除未使用代码

2. **渲染优化**：
   - 使用虚拟滚动处理大量数据
   - 合理使用 keep-alive 缓存组件

### 后端优化
1. **缓存策略**：
   - 合理使用 Cloudflare KV 缓存
   - 为频繁查询的结果设置缓存

2. **数据库优化**：
   - 优化查询语句
   - 合理使用索引

## 文档规范

### 代码注释
1. **函数注释**：
   - 导出的函数应有 JSDoc 注释
   - 注释应包含参数说明和返回值说明

2. **复杂逻辑**：
   - 复杂算法和业务逻辑应有详细注释
   - 注释应解释为什么这样做，而不仅仅是做什么

### 技术文档
1. **API 文档**：
   - 使用 Swagger/OpenAPI 规范编写 API 文档
   - 保持文档与代码同步

2. **架构文档**：
   - 重要架构决策应记录在 RFC 文档中
   - 数据库设计应有 ER 图和说明

## 开发环境

### 本地开发
1. **环境配置**：
   - 使用 .env 文件管理环境变量
   - 提供完整的开发环境搭建指南

2. **调试工具**：
   - 使用 Chrome DevTools 调试前端
   - 使用 Wrangler 调试 Cloudflare Workers

### 依赖管理
1. **包管理**：
   - 使用 npm 作为包管理器
   - 定期更新依赖并检查安全漏洞

2. **版本锁定**：
   - 使用 package-lock.json 锁定依赖版本
   - 重要依赖升级需要测试验证

## 部署规范

### 构建流程
1. **自动化构建**：
   - 使用 GitHub Actions 实现 CI/CD
   - 构建过程应包含代码检查和测试

2. **环境分离**：
   - 开发、测试、生产环境配置分离
   - 使用不同的环境变量配置

### 监控告警
1. **日志记录**：
   - 关键操作应有日志记录
   - 错误信息应包含足够的上下文

2. **性能监控**：
   - 前端性能指标监控
   - API 响应时间和错误率监控